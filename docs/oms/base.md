# 基础模块
简单说明用户和菜单

---

## 用户模块

### 1. django自定义用户

用户表增加 `通知属性` 字段，因为公司的主要通讯工具用的是skype，所以这个项目我加的是`skype`，你也可以把它定义成其他字段。

### 2. 账号与AD域控结合(ldap)

使用的是 `django-python3-ldap` 模块，集中用户管理，但是这个模块原本是不能同步用户组数据到oms系统，而这个系统所使用的权限管理是基于用户组做的， 所以必须对其稍作修改，文件 [lday.py](https://github.com/itimor/django-oms/blob/master/ldap.py), 替换 `/to/path/site-packages/django_python3_ldap/ldap.py`, 这样就可以同步用户组信息了， 甚至你还可增加其他字段， 改改脚本一样能同步。


![首页](/assets/images/base/base1.png)

### 3. 用户组和角色
用户组表本身不用做任何操作，数据是从 `ldap` 同步过来的，oms系统的菜单、按钮、部分数据等权限都是围绕它做的。

角色是保留字段， 没有使用，用得着的人可以启用它。

---

## 菜单模块

### 1. 菜单
这里只存放一级菜单、二级菜单和页面元素的数据。

### 2. 菜单权限
当用户登录时，后端会根据之前用户绑定的菜单信息生成一个前端所需要的路由数据，如下：

``` json
{
    "groups": [
        "CS_Dept",
        "CS_sharepoint",
        "CS_File",
        "客服部IM"
    ],
    "menus": [
        "添加工单",
        "工单系统",
        "编辑工单",
        "查看工单",
        "工单列表"
    ],
    "elements": [
        "工单列表-新建工单按钮"
    ]
}
```

前端拿到这段数据后，会先判断 `groups` 里是否有超级管理员组，有的话给与全部权限，没有就根据 `menus` 与路由表进行比对生成符合用户权限的路由表， `elements` 是页面元素权限，主要是针对一些按钮或是超链接的控制。例如上面的用户就只能看到工单列表页，并且有工单页面的添加工单权限。

---



